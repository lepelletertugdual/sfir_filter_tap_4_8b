# ##################################################################################################################################################################################
# file :
#     run_gen_heartbeat.tcl
# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# purpose :
#     creating VIVADO project for synthesis and simulation.
# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# limitation :
#     none.
# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# author :
#     Tugdual LE PELLETER
# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# history :
#     2023-11-11
#         file creation
# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# table of contents :
#    01. defining environment constants
#    02. creating VIVADO project
#    03. adding files
#        03.01. synthesis
#            03.01.01. design
#        03.02. simulation
#            03.02.01. design
#            03.02.02. packages
#            03.02.03. testbench
#    04. setting testbench module for simulation
#    05. updating compilation order
#    06. setting project parameters
#    07. setting synthesis engine options
#    08. launching VIVADO EDA tool
# ##################################################################################################################################################################################

# ##################################################################################################################################################################################
# 01. defining environment constants
# ##################################################################################################################################################################################

set name_board     zedboard
set name_dut       sfir_filter_4
set name_project   ${name_dut}
set name_part      xc7z020clg484-3
set name_language  vhdl
set name_top_level ${name_dut}
set name_bench     bch_${name_dut}

# ##################################################################################################################################################################################
# 02. creating VIVADO project
# ##################################################################################################################################################################################

create_project -force -name ${name_project}

# ##################################################################################################################################################################################
# 03. adding files
# ##################################################################################################################################################################################
    # ==============================================================================================================================================================================
	# 03.01. synthesis
    # ==============================================================================================================================================================================
		# --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
		# 03.01.01. packages
	    # --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        add_files -fileset sources_1 {
	        ./../../sources/package/pkg_gen_heartbeat.vhd
        }

		# --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
		# 03.01.02. design
	    # --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        add_files -fileset sources_1 {
            ./../../sources/design/gen_heartbeat.vhd
			./../../sources/design/sfir_filter_4.vhd
        }
	
    # ==============================================================================================================================================================================
	# 03.02. simulation
    # ==============================================================================================================================================================================
		# --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
		# 03.02.01. packages
	    # --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        add_files -fileset sim_1 {
            ./../../sources/package/pkg_mgt_file.vhd
	        ./../../sources/package/pkg_gen_heartbeat.vhd
        }

		# --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
		# 03.02.02. design
	    # --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        add_files -fileset sim_1 {
            ./../../sources/design/gen_heartbeat.vhd
			./../../sources/design/sfir_filter_4.vhd
        }

		# --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
		# 03.02.03. testbench
	    # --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        add_files -fileset sim_1 {
            ./../../sources/bench/bch_sfir_filter_4.vhd
        }

# ##################################################################################################################################################################################
# 04. setting top-level module for simulation
# ##################################################################################################################################################################################

set_property top ${name_bench} [get_filesets sim_1]

# ##################################################################################################################################################################################
# 05. updating compilation order
# ##################################################################################################################################################################################

update_compile_order -fileset sources_1
update_compile_order -fileset sim_1

# ##################################################################################################################################################################################
# 06. setting project parameters
# ##################################################################################################################################################################################

set_property target_language ${name_language} [current_project]
set_property part            ${name_part}     [current_project]

# ##################################################################################################################################################################################
# 07. running synthesis
# ##################################################################################################################################################################################

synth_design -directive        PerformanceOptimized \
			 -fsm_extraction   one_hot              \
			 -resource_sharing off                  \
			 -incremental_mode aggressive           \
			 -retiming                              \
			 -debug_log                             \
			 -verbose

# ##################################################################################################################################################################################
# 08. launching VIVADO EDA tool
# ##################################################################################################################################################################################

start_gui

# ##################################################################################################################################################################################
# EOF
# ##################################################################################################################################################################################